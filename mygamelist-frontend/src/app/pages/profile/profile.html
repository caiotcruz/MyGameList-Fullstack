<div class="profile-container">

  <div class="profile-header">
    <div class="cover-bg"></div>
    <div class="header-content">
        
        <div class="avatar-large">
            <img *ngIf="userAvatar" [src]="userAvatar" alt="Avatar" class="avatar-img">
            <span *ngIf="!userAvatar">{{ userName.charAt(0).toUpperCase() }}</span>
        </div>

        <div class="user-info">
            <h1>{{ userName }}</h1>
            
            <p class="bio" *ngIf="userBio">{{ userBio }}</p>
            <p></p>
            <p class="subtitle" *ngIf="!userBio">Membro do MyGameList</p>

            <button *ngIf="isMyProfile" class="btn-edit-profile" (click)="abrirEdicao()">
                ‚úèÔ∏è Editar Perfil
            </button>
        </div>

        <div class="profile-social-stats">
            <div class="stat-item">
              <strong>{{ statsCounts.followers }}</strong>
              <span>Seguidores</span>
            </div>
            <div class="divider">‚Ä¢</div>
            <div class="stat-item">
              <strong>{{ statsCounts.following }}</strong>
              <span>Seguindo</span>
            </div>
        </div>
    </div>
  </div>

  <div *ngIf="userGames.length > 0">
    <div class="highlights-grid">
      <div class="highlight-card" *ngIf="favoriteGame">
        <div class="highlight-label">üèÜ Jogo Favorito</div>
        <div class="highlight-content">
          <img [src]="favoriteGame.game.coverUrl || favoriteGame.game.background_image" alt="Capa">
          <div>
            <h3>{{ favoriteGame.game.title }}</h3>
            <p class="highlight-score" *ngIf="favoriteGame.score > 0">Nota: {{ favoriteGame.score }}/10</p>
            <p class="highlight-score" *ngIf="favoriteGame.score === 0">Favorito ‚ù§Ô∏è</p>
          </div>
        </div>
      </div>

      <div class="highlight-card" *ngIf="badges.length > 0">
        <div class="highlight-label">üéñÔ∏è Conquistas</div>
        <div class="badges-grid">
          <div class="badge-item" *ngFor="let badge of badges" [style.border-color]="badge.color">
            <span class="badge-icon">{{ badge.icon }}</span>
            <span class="badge-text" [style.color]="badge.color">{{ badge.label }}</span>
            <span class="custom-tooltip">{{ badge.description }}</span>
          </div>
        </div>
      </div>

      <div class="highlight-card stats-center">
          <div class="highlight-label">üìä M√©dia Geral</div>
          <div class="big-number">{{ stats.avgScore | number:'1.1-1' }}</div>
          <p class="sub-text">Baseado em {{ userGames.length }} jogos</p>
      </div>
    </div>

    <div class="chart-section" *ngIf="stats.avgScore > 0">
       <div class="highlight-label">üìà Distribui√ß√£o de Notas</div>
       <div class="chart-container">
         <div class="chart-bar-group" *ngFor="let data of chartData">
            <div class="bar-area">
               <span class="bar-tooltip" *ngIf="data.count > 0">{{ data.count }}</span>
               <div class="bar-fill" [style.height.%]="data.heightPc" [class.has-data]="data.count > 0"></div>
            </div>
            <span class="bar-label">{{ data.score }}</span>
         </div>
       </div>
    </div>
  </div>

  <div class="list-section">
    <h3>{{ isMyProfile ? 'Minha Cole√ß√£o' : 'Cole√ß√£o Completa' }}</h3>
    <app-game-list 
      [games]="userGames" 
      [isOwner]="isMyProfile" 
      (listUpdated)="onListUpdated()">
    </app-game-list>
  </div>

  <div class="empty-state" *ngIf="userGames.length === 0">
    <p>Este usu√°rio ainda n√£o iniciou sua jornada.</p>
  </div>
</div>

<div class="modal-backdrop" *ngIf="isEditingProfile">
  <div class="modal-content-edit">
    <h3>Editar Perfil</h3>

    <div class="form-group">
      <label>Nome de Exibi√ß√£o</label>
      <input type="text" [(ngModel)]="editData.name" placeholder="Seu nome">
    </div>

    <div class="form-group">
      <label>Foto de Perfil (URL)</label>
      <input type="text" [(ngModel)]="editData.profilePicture" placeholder="https://exemplo.com/foto.jpg">
      <small>Cole o link de uma imagem da internet.</small>
    </div>

    <div class="form-group">
      <label>Bio (Sobre Mim)</label>
      <textarea rows="3" [(ngModel)]="editData.bio" maxlength="500" placeholder="Conte um pouco sobre seus jogos favoritos..."></textarea>
      <small class="char-count">{{ editData.bio?.length || 0 }}/500</small>
    </div>

    <div class="modal-actions">
      <button class="btn-cancel" (click)="isEditingProfile = false">Cancelar</button>
      <button class="btn-save" (click)="salvarPerfil()">Salvar Altera√ß√µes</button>
    </div>
  </div>
</div>